<ul id="list">
</ul>
<script type="importmap">
  {
    "imports": {
      "urlpattern-polyfill": "https://esm.sh/urlpattern-polyfill@10.0.0",
      "axios": "https://cdn.skypack.dev/axios",
      "ld": "https://localhost/ld.js"
    }
  }
</script>
<script type="module">
  import ld from "ld";
	import axios from "axios";
  // todo: use polyfill https://github.com/kenchris/urlpattern-polyfill
  const pattern = new URLPattern("/authors/:id", "https://localhost");

  const list = document.getElementById('list')
  axios.get('/books')
    .then(async (books) => {
      const b = ld(books.data, pattern, () => {
        const l = []
        b['hydra:member'].forEach((book) => {
          const li = document.createElement('li')
          li.dataset.testid = 'book'
          li.innerText = `${book.title} - ${book.author?.name}`
          l.push(li)
        });
        list.replaceChildren(...l)
      })

      b['hydra:member'].forEach((book) => {
        const li = document.createElement('li')
        li.dataset.testid = 'book'
        li.innerText = `${book.title} - ${book.author?.name}`
        list.appendChild(li)
      });
    })
</script>

